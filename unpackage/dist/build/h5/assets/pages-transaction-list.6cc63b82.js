import{a as e,s as t,X as a,a5 as s,j as r,H as l,I as o,M as n,o as c,c as i,w as d,i as _,b as f,d as u,t as m,p as w,q as h,F as p,e as x,a0 as g,y as b,S as k,v as y,a8 as T}from"./index.3b969e63.js";import{_ as C}from"./z-paging.ba247825.js";import{r as v}from"./uni-app.es.02f92043.js";import{A as L}from"./app.7b4b9720.js";import{W as j}from"./wallet.af230502.js";import{E as D,P as H,f as z,I as E}from"./etherApi.0507bc32.js";import{T as F}from"./transaction.34cd50cf.js";import{T as A}from"./token.0e0bad13.js";import{_ as N}from"./ETH.9f110baa.js";import{_ as P,a as B}from"./qr.c827c99f.js";import{_ as S,a as R}from"./receive.ddf657b9.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";import"./md5.c7cedf05.js";import"./wallet.f064e6a3.js";import"./config.d9a5f6eb.js";const $=W({data:()=>({network_list:e().globalData.global_network_list,global_network_index:e().globalData.global_network_index,current_network:{network:"__",url:"",color:"#f6f6f6",etherscan_api:""},current_wallet:{address:"0x...........................",name:"my wallet",keystore:"",balance:"__",usd_worth:"__",tokens:[]},balance:"__",usd_worth:"__",token_info:{balance:"__",usd_worth:"__"},tx_list:[],filter_contract_address:"",filter_token:"",load_more_default_text:{en:"Pull up to load more","zh-Hans":"下拉加载更多"},load_more_loading_text:{en:"loading","zh-Hans":"加载中"},load_more_no_more_text:{en:"no more","zh-Hans":"没有了"},load_more_fail_text:{en:"Failed to load,try agin","zh-Hans":"加载失败,请重试"}}),onLoad(e){if(L.checkAppInit()){if(this.current_network=this.network_list[this.global_network_index],!e.address)return t({title:"Param exception",icon:"error"}),void a();this.current_wallet.address=e.address,this.filter_contract_address=e.contract_address?e.contract_address:"",this.filter_token=e.token?e.token:"",this.loadWalletData()}},onPullDownRefresh(){this.loadWalletData(),this.loadTxData(1,10),setTimeout((function(){s()}),2e3)},methods:{loadWalletData:async function(){let e=j.getWallet(this.current_wallet.address);if(!e)return r({title:"Data exception, please contact admin",showCancel:!1,confirmText:"Got it"}),console.log("读取钱包数据异常"),!1;this.current_wallet=e,this.filter_contract_address?this.loadTokenBal():this.loadEthBal()},loadEthBal:async function(){let e=new D.etherApi(this.current_network),t=await e.getBalance(this.current_wallet.address);if(t){this.current_network.balance=Number(t).toFixed(8);let e=await H.getPrice("ETHUSDT");this.current_network.usd_worth=e?(Number(this.current_network.balance)*Number(e)).toFixed(2):"__"}else this.current_network.balance="__",this.current_network.usd_worth="__";return this.balance=this.current_network.balance,this.usd_worth=this.current_network.usd_worth,!0},loadTokenBal:async function(){let e=A.getToken(this.filter_contract_address);if(!e)return!1;let t=new D.etherApi(this.current_network),a=await t.getContractAssetBalance(e.contract_address,e.abi,this.current_wallet.address,e.decimal);if(a){e.balance=Number(a).toFixed(8);let t=await H.getPrice(e.symbol+"USDT");e.usd_worth=t?(Number(e.balance)*Number(t)).toFixed(2):"__"}else e.balance="__",e.usd_worth="__";return this.balance=e.balance,this.usd_worth=e.usd_worth,this.token_info=e,!0},loadTxData:async function(e,t){l({});let a=[],s=F.getTxList(this.current_wallet.address);if([]==s)return o(),this.$refs.paging.complete([]),!1;if(!1===s)return this.$refs.paging.complete(!1),!1;let r=new D.etherApi(this.network_list[this.global_network_index]);for(let l of s){let e=await r.getTransactionReceipt(l.hash);if(e&&e.status&&1!=e.status&&(l.tx_status="Confirming",F.saveTx(l)),e&&e.status&&1==e.status&&(l.tx_status="Successful",l.txreceipt_status=1,l.gas_used=e.gasUsed,l.gas_price=e.gasPrice,l.gas_fee=Number(z(l.gas_used*l.gas_price)).toFixed(8),l.block_hash=e.blockHash,l.block_number=e.blockNumber,F.saveTx(l)),l.data&&"0x"!=l.data){let e=A.getToken(l.to);if(!e)continue;const t=new E(e.abi).parseTransaction({data:l.data,value:l.value});if("transfer"!=t.name){a.push(l);continue}l.decode_data=t,l.contract_info=e,l.to.toLowerCase()==this.filter_contract_address.toLowerCase()&&a.push(l)}else this.filter_contract_address||a.push(l)}let n=[],c=[];for(let l of a)1==l.txreceipt_status?c.push(l):n.push(l);return n.sort((function(e,t){return t.timestamp-e.timestamp})),c.sort((function(e,t){return t.timestamp-e.timestamp})),a=n.concat(c),o(),a.length?(this.$refs.paging.complete(a),this.tx_list=a,a):(this.$refs.paging.complete([]),[])},toTxDetail:function(e,t){n({url:"/pages/transaction/detail?tx_hash="+e+"&address="+t})}}},[["render",function(e,t,a,s,r,l){const o=x,n=_,L=g,j=T,D=v(b("z-paging"),C);return c(),i(n,null,{default:d((()=>[f(n,{class:"wallet-info"},{default:d((()=>[f(n,{class:"flex-column-start-center"},{default:d((()=>[f(o,{class:"asset-icon",src:N}),f(n,{class:"asset-balance font-second-title"},{default:d((()=>[u(m(r.balance),1)])),_:1}),f(n,{class:"asset-usd-worth font-desc-gray"},{default:d((()=>[u("$ "+m(r.usd_worth),1)])),_:1})])),_:1}),f(n,{class:"func-list flex-row-space-between-center"},{default:d((()=>[f(L,{class:"func-item flex-column-start-center","open-type":"navigate",url:"/pages/transfer/transfer"},{default:d((()=>[f(o,{class:"func-icon",src:P}),f(n,{class:"font-desc-black-little"},{default:d((()=>[u("Transfer")])),_:1})])),_:1}),f(L,{class:"func-item flex-column-start-center",url:"/pages/receive/receive?address="+r.current_wallet.address},{default:d((()=>[f(o,{class:"func-icon",src:B}),f(n,{class:"font-desc-black-little"},{default:d((()=>[u("Receive")])),_:1})])),_:1},8,["url"])])),_:1})])),_:1}),f(n,{class:"tx-list"},{default:d((()=>[f(D,{ref:"paging","refresher-enabled":!1,fixed:!1,height:"700rpx","use-page-scroll":!1,"loading-more-enabled":!0,"default-page-size":20,"to-bottom-loading-more-enabled":!0,"loading-more-default-text":r.load_more_default_text,"loading-more-loading-text":r.load_more_loading_text,"loading-more-no-more-text":r.load_more_no_more_text,"loading-more-fail-text":r.load_more_fail_text,modelValue:r.tx_list,"onUpdate:modelValue":t[0]||(t[0]=e=>r.tx_list=e),onQuery:l.loadTxData},{default:d((()=>[(c(!0),w(p,null,h(r.tx_list,((e,t)=>(c(),i(n,{class:"tx-item",onClick:t=>l.toTxDetail(e.hash,r.current_wallet.address)},{default:d((()=>[e.decode_data&&"transfer"==e.decode_data.name?(c(),i(n,{key:0,class:"flex-row-space-between-center"},{default:d((()=>[f(n,{class:"tx-item-left flex-row-center-center"},{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(o,{key:0,class:"tx-icon",src:S})):(c(),i(o,{key:1,class:"tx-icon",src:R})),f(n,null,{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(n,{key:0,class:"font-desc-black"},{default:d((()=>[u("Send "+m(e.contract_info.symbol),1)])),_:2},1024)):(c(),i(n,{key:1,class:"font-desc-black receive-color"},{default:d((()=>[u("Receive "+m(e.contract_info.symbol),1)])),_:2},1024)),f(n,{class:"font-desc-gray-little",style:{"margin-top":"5rpx"}},{default:d((()=>[u(m(e.humanize_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(n,{class:"tx-item-right flex-column-end-end"},{default:d((()=>[f(n,{class:k(["font-desc-black flex-row-center-center",[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?"font-desc-black":"receive-color"]])},{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(n,{key:0},{default:d((()=>[u("-")])),_:1})):(c(),i(n,{key:1},{default:d((()=>[u("+")])),_:1})),f(n,null,{default:d((()=>[u(m(e.decode_data.args[1])+" "+m(e.contract_info.symbol),1)])),_:2},1024)])),_:2},1032,["class"]),f(n,{class:"font-desc-gray-little",style:{"margin-top":"5rpx"}},{default:d((()=>[u(m(e.tx_status),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):(c(),i(n,{key:1,class:"flex-row-space-between-center"},{default:d((()=>[f(n,{class:"tx-item-left flex-row-center-center"},{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(o,{key:0,class:"tx-icon",src:S})):(c(),i(o,{key:1,class:"tx-icon",src:R})),f(n,null,{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(n,{key:0,class:"font-desc-black"},{default:d((()=>[u("Send ETH")])),_:1})):(c(),i(n,{key:1,class:"font-desc-black receive-color"},{default:d((()=>[u("Receive ETH")])),_:1})),f(n,{class:"font-desc-gray-little",style:{"margin-top":"5rpx"}},{default:d((()=>[u(m(e.humanize_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(n,{class:"tx-item-right flex-column-end-end"},{default:d((()=>[f(n,{class:k(["font-desc-black flex-row-center-center",[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?"font-desc-black":"receive-color"]])},{default:d((()=>[e.from.toLowerCase()==r.current_wallet.address.toLowerCase()?(c(),i(n,{key:0},{default:d((()=>[u("-")])),_:1})):(c(),i(n,{key:1},{default:d((()=>[u("+")])),_:1})),f(n,null,{default:d((()=>[u(m(e.eth_num)+"ETH",1)])),_:2},1024)])),_:2},1032,["class"]),f(n,{class:"font-desc-gray-little",style:{"margin-top":"5rpx"}},{default:d((()=>[u(m(e.tx_status),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),1!=e.txreceipt_status?(c(),i(n,{key:2,class:"tx-progress flex-row-end-center"},{default:d((()=>[f(n,{style:{width:"65rpx"}}),f(j,{percent:"0",activeColor:"#10AEFF","stroke-width":"3"})])),_:1})):y("",!0)])),_:2},1032,["onClick"])))),256))])),_:1},8,["loading-more-default-text","loading-more-loading-text","loading-more-no-more-text","loading-more-fail-text","modelValue","onQuery"])])),_:1})])),_:1})}],["__scopeId","data-v-1cf6b4ae"]]);export{$ as default};
